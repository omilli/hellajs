#!/bin/sh

# Run sync function after successful commit
echo "Running sync function..."
~/.bun/bin/bun run sync

# Check if sync was successful
if [ $? -ne 0 ]; then
  echo "Warning: Sync function failed but commit was successful"
  exit 0
fi

# Check if any AGENTS.md files were modified (staged or unstaged)
if git diff --name-only HEAD | grep -q "AGENTS\.md" || git diff --name-only | grep -q "AGENTS\.md"; then
  echo "AGENTS.md files were updated, creating auto-commit..."

  # Add all AGENTS.md files
  find . -name "AGENTS.md" -type f -exec git add {} + 2>/dev/null

  # Create a commit for the AGENTS file updates
  git commit -m "chore: sync AGENTS files" --no-verify

  if [ $? -eq 0 ]; then
    echo "Auto-committed AGENTS.md updates"
  else
    echo "No AGENTS.md changes to commit"
  fi
fi

exit 0
